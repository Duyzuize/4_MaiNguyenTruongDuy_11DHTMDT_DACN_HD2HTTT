@model TourWebApp.Data.Models.BaiViet

@{
    ViewData["Title"] = Model.TieuDe;
    var binhLuans = ViewBag.BinhLuans as List<TourWebApp.Data.Models.BinhLuanTour>;
    bool daDangNhap = ViewBag.DaDangNhap == true;
}

<section class="container my-5">

    <a asp-action="Index" class="btn btn-outline-primary mb-3">‚Üê Quay l·∫°i Blog</a>

    <h2 class="fw-bold mb-2">@Model.TieuDe</h2>

    <p class="text-muted">
        üìÖ @Model.NgayDang.ToString("dd/MM/yyyy")
        | üìÇ @Model.IdCMNavigation?.TenCM
    </p>

    <!-- ‚úÖ H√åNH ·∫¢NH -->
    @{
        string img = "/img/blog/default.jpg";
        if (!string.IsNullOrEmpty(Model.HinhAnh))
        {
            img = "/" + Model.HinhAnh.TrimStart('/');
        }
    }

    <img src="@img"
         class="w-100 rounded mb-4 shadow-sm"
         style="max-height:420px;object-fit:cover" />

    <article class="fs-5" style="line-height:1.7">
        @Html.Raw(Model.NoiDung.Replace("\n","<br/>"))
    </article>
</section>

<!-- ================== B√åNH LU·∫¨N ================== -->
<section class="container my-5">

    <hr />
    <h4 class="fw-bold mb-4">üí¨ B√¨nh lu·∫≠n b√†i vi·∫øt</h4>

    @if (binhLuans == null || binhLuans.Count == 0)
    {
        <p class="fst-italic text-muted">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
    }
    else
    {
        foreach (var bl in binhLuans)
        {
            <div class="p-3 mb-3 rounded bg-light shadow-sm">
                <div class="d-flex">

                    <!-- ‚úÖ AVATAR C·ªê ƒê·ªäNH -->
                    <img src="~/img/icons/user.png"
                         style="width:45px;height:45px;border-radius:50%"
                         class="me-3 border" />

                    <div class="flex-grow-1">
                        <strong>@bl.Ten</strong>
                        <span class="badge bg-secondary ms-1">Th√†nh vi√™n</span>

                        <div class="text-muted small">
                            @bl.NgayBL.ToString("dd/MM/yyyy HH:mm")
                        </div>

                        <p class="mt-2 mb-0">@bl.NoiDung</p>
                        @if (!string.IsNullOrEmpty(bl.PhanHoiAdm))
                        {
                            <div class="ms-5 mt-3 p-3 bg-white border-start border-3 border-danger rounded shadow-sm">
                                <strong class="text-danger">
                                    HappyTrip Admin
                                </strong>
                                <span class="badge bg-danger ms-1">ADMIN</span>

                                <div class="text-muted small mt-1">
                                    Ph·∫£n h·ªìi t·ª´ qu·∫£n tr·ªã vi√™n
                                </div>

                                <p class="mb-0 mt-2">
                                    @bl.PhanHoiAdm
                                </p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    }

    <hr />

    <!-- ================== FORM B√åNH LU·∫¨N ================== -->
    @if (daDangNhap)
    {
        <form asp-action="ThemBinhLuan" method="post" class="mt-4">
            <input type="hidden" name="idBaiViet" value="@Model.IdBaiViet" />

            <textarea name="noiDung"
                      class="form-control mb-3"
                      rows="4"
                      placeholder="Chia s·∫ª c·∫£m nghƒ© c·ªßa b·∫°n..."
                      required></textarea>

            <button class="btn btn-primary">G·ª≠i b√¨nh lu·∫≠n</button>
        </form>
    }
    else
    {
        <div class="text-center text-muted py-4">
            <i class="fa-solid fa-lock me-1"></i>
            <a asp-controller="TaiKhoan"
                asp-action="DangNhap"
                asp-route-returnUrl="@Context.Request.Path"
                class="fw-bold text-decoration-none">
                ƒêƒÉng nh·∫≠p
            </a>

            ƒë·ªÉ tham gia th·∫£o lu·∫≠n v√† chia s·∫ª tr·∫£i nghi·ªám du l·ªãch c·ªßa b·∫°n üí¨
        </div>
    }
</section>

<link rel="stylesheet" href="~/css/blog.css" />
