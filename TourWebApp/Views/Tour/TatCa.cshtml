@model List<TourWebApp.Data.Models.Tour>

@{
    ViewData["Title"] = "T·∫•t c·∫£ tour";
    var lichGanNhat = ViewBag.LichGanNhat as Dictionary<int, TourWebApp.Data.Models.LichKhoiHanh>;
}
<link rel="stylesheet" href="~/css/tour-filter.css" />

<div class="text-end mb-3">
    <button type="button" class="btn btn-outline-primary fw-bold rounded-pill"
            data-bs-toggle="modal" data-bs-target="#filterModal">
        üîç B·ªô l·ªçc
    </button>
</div>

<h2 class="title-all-tour text-center">T·∫•t c·∫£ tour</h2>




<!-- =================== LIST TOUR =================== -->
<div class="row g-4">

@foreach (var t in Model)
{
    var lich = (lichGanNhat != null && lichGanNhat.ContainsKey(t.IdTour))
    ? lichGanNhat[t.IdTour]
    : null;

    string trangThai = "Kh√¥ng c√≥ l·ªãch";
    string ngay = "--";
    string gio = "--";
    string socho = "--";

    if (lich != null)
    {
        ngay = lich.NgayKhoiHanh.ToString("dd/MM/yyyy");
        gio = lich.GioKhoiHanh?.ToString("HH:mm") ?? "--";
        socho = lich.SoChoConLai.ToString();

        trangThai = lich.SoChoConLai <= 0 ? "H·∫øt ch·ªó" : "C√≤n ch·ªó";
    }

    <div class="col-lg-3 col-md-6">

        <div class="tour-card-modern shadow-lg rounded-4 overflow-hidden">

            <!-- BADGE GI·∫¢M GI√Å -->
            @if (t.PhanTramGiam > 0)
            {
                <div class="position-absolute top-0 end-0 m-3 px-3 py-2 bg-warning rounded-pill text-white fw-bold">
                    -@t.PhanTramGiam%
                </div>
            }

            <!-- IMAGE -->
            <div class="position-relative" style="height:240px; overflow:hidden;">
                <img src="~/img/tours/@t.HinhAnh"
                     class="w-100 h-100"
                     style="object-fit:cover; border-radius:10px;" />
            </div>

            <!-- INFO OVERLAY (PH·∫¶N CON MU·ªêN) -->
            <div class="bg-light p-3 border-bottom">

                <p class="mb-1"><b>M√£ tour:</b> @t.MaTour</p>
                <p class="mb-1"><b>ƒêi·ªÉm ƒë·∫øn:</b> @t.DiaDiem</p>

                <p class="mb-1"><b>Ng√†y g·∫ßn nh·∫•t:</b> @ngay</p>
                <p class="mb-1"><b>Gi·ªù kh·ªüi h√†nh:</b> @gio</p>
                <p class="mb-1"><b>C√≤n l·∫°i:</b> @socho ch·ªó</p>
                <p class="mb-1"><b>Tr·∫°ng th√°i:</b> @trangThai</p>

                <p class="mb-0"><b>Ph∆∞∆°ng ti·ªán:</b> @t.PhuongTien</p>
            </div>

            <!-- BODY -->
            <div class="p-3">

                <h4 class="fw-bold">@t.TenTour</h4>

                <div class="text-secondary mb-2">
                    @t.ThoiGian
                </div>

                <div class="d-flex align-items-center gap-3 mb-3">
                    <span class="fw-bold text-danger fs-4">@string.Format("{0:N0} ƒë", t.GiaKhuyenMai)</span>
                    <span class="text-decoration-line-through text-muted">@string.Format("{0:N0} ƒë", t.GiaGoc)</span>
                </div>

                <a asp-controller="Tour"
                   asp-action="ChiTiet"
                   asp-route-id="@t.IdTour"
                   class="btn btn-primary w-100 fw-bold rounded-pill">
                    Xem chi ti·∫øt
                </a>

            </div>

        </div>

    </div>
}

</div>
<!-- ================= MODAL FILTER ================= -->
<div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-4">

            <div class="modal-header">
                <h5 class="modal-title fw-bold">üîç B·ªô l·ªçc n√¢ng cao</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form method="get" id="filterForm">
                <div class="modal-body">

                    <div class="row g-3">

                        <!-- ƒêI·ªÇM ƒê·∫æN -->
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">ƒêi·ªÉm ƒë·∫øn</label>

                            <input type="text" name="diadiem" id="diadiemInput"
                                class="form-control"
                                placeholder="VD: ƒê√† L·∫°t, Nha Trang..."
                                autocomplete="off"
                                value="@Context.Request.Query["diadiem"]">

                            <div class="autocomplete-box" id="goiYBox"></div>
                        </div>

                        <!-- S·ªê NG√ÄY -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">S·ªë ng√†y</label>
                            <input type="number" name="songay"
                                   class="form-control"
                                   placeholder="VD: 3"
                                   value="@Context.Request.Query["songay"]"/>
                        </div>

                       
                       <div class="col-12 mt-2">
                            <label class="form-label fw-semibold">Kho·∫£ng gi√°</label>

                            <div class="price-slider-container">
                                <div class="slider-track"></div>

                                <input type="range" class="range-min" min="0" max="20000000" step="50000" value="0">
                                <input type="range" class="range-max" min="0" max="20000000" step="50000" value="20000000">
                            </div>

                            <div class="d-flex justify-content-between mt-3">
                                <div>
                                    <span class="fw-bold">T·ª´:</span>
                                    <input type="text" name="giamin" id="giaminInput"
                                        class="form-control money-input"
                                        style="width:150px;">
                                </div>

                                <div>
                                    <span class="fw-bold">ƒê·∫øn:</span>
                                    <input type="text" name="giamax" id="giamaxInput"
                                        class="form-control money-input"
                                        style="width:150px;">
                                </div>
                            </div>
                        </div>

                        <!-- SORT -->
                        <div class="col-12 mt-3">
                            <label class="form-label fw-semibold">S·∫Øp x·∫øp</label>
                            <select name="sort" class="form-select">
                                <option value="">-- Kh√¥ng s·∫Øp x·∫øp --</option>
                                <option value="gia_tang" selected="@(Context.Request.Query["sort"]=="gia_tang")">Gi√° tƒÉng d·∫ßn</option>
                                <option value="gia_giam" selected="@(Context.Request.Query["sort"]=="gia_giam")">Gi√° gi·∫£m d·∫ßn</option>
                                <option value="ten" selected="@(Context.Request.Query["sort"]=="ten")">T√™n A ‚Üí Z</option>
                            </select>
                        </div>

                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary px-4 rounded-pill fw-bold">√Åp d·ª•ng</button>
                </div>
            </form>

        </div>
    </div>
</div>

@if (ViewBag.TotalPages > 1)
{
    <div class="d-flex justify-content-center mt-5 gap-2">

        @if (ViewBag.CurrentPage > 1)
        {
            <a class="btn btn-outline-primary rounded-pill"
               href="?page=@(ViewBag.CurrentPage - 1)&diadiem=@Context.Request.Query["diadiem"]&songay=@Context.Request.Query["songay"]&giamin=@Context.Request.Query["giamin"]&giamax=@Context.Request.Query["giamax"]&sort=@Context.Request.Query["sort"]">
                ‚Üê
            </a>
        }

        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <a class="btn @(i == ViewBag.CurrentPage ? "btn-primary" : "btn-outline-primary") rounded-pill"
               href="?page=@i&diadiem=@Context.Request.Query["diadiem"]&songay=@Context.Request.Query["songay"]&giamin=@Context.Request.Query["giamin"]&giamax=@Context.Request.Query["giamax"]&sort=@Context.Request.Query["sort"]">
                @i
            </a>
        }

        @if (ViewBag.CurrentPage < ViewBag.TotalPages)
        {
            <a class="btn btn-outline-primary rounded-pill"
               href="?page=@(ViewBag.CurrentPage + 1)&diadiem=@Context.Request.Query["diadiem"]&songay=@Context.Request.Query["songay"]&giamin=@Context.Request.Query["giamin"]&giamax=@Context.Request.Query["giamax"]&sort=@Context.Request.Query["sort"]">
                ‚Üí
            </a>
        }

    </div>
}
<script src="~/js/filter-slider.js"></script>
