@model List<TourWebApp.Data.Models.BinhLuanTour>

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<h3 class="fw-bold mb-4">üí¨ Qu·∫£n l√Ω b√¨nh lu·∫≠n</h3>
@{
    var loai = (ViewBag.Loai as string) ?? "";
}

<form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
        <select name="loai" class="form-select" onchange="this.form.submit()">
            <option value="" selected="@(loai == "")">T·∫•t c·∫£</option>
            <option value="tour" selected="@(loai == "tour")">Ch·ªâ b√¨nh lu·∫≠n Tour</option>
            <option value="baiviet" selected="@(loai == "baiviet")">Ch·ªâ b√¨nh lu·∫≠n B√†i vi·∫øt</option>
        </select>
    </div>
</form>

<table class="table table-bordered align-middle">
    <thead class="table-dark">
        <tr>
            <th width="160">Ng∆∞·ªùi b√¨nh lu·∫≠n</th>
            <th width="220">ƒê·ªëi t∆∞·ª£ng</th>
            <th>N·ªôi dung</th>
            <th width="120">Ng√†y</th>
            <th width="120">Tr·∫°ng th√°i</th>
            <th width="200">Thao t√°c</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var bl in Model)
        {
            <tr>
                <!-- NG∆Ø·ªúI B√åNH LU·∫¨N -->
                <td>
                    <strong>@bl.Ten</strong><br />
                    <small class="text-muted">@bl.Email</small>
                </td>

                <!-- ƒê·ªêI T∆Ø·ª¢NG -->
                <td>
                    @if (bl.IdTourNavigation != null)
                    {
                        <div>
                            <span class="badge bg-info text-dark me-1">Tour</span>
                            <span>@bl.IdTourNavigation.TenTour</span>
                        </div>
                    }
                    else if (bl.IdBaiVietNavigation != null)
                    {
                        <div>
                            <span class="badge bg-secondary me-1">B√†i vi·∫øt</span>
                            <span>@bl.IdBaiVietNavigation.TieuDe</span>
                        </div>
                    }
                    else
                    {
                        <span class="text-muted fst-italic">Kh√¥ng x√°c ƒë·ªãnh</span>
                    }
                </td>


                <!-- N·ªòI DUNG -->
                <td>
                    <div>@bl.NoiDung</div>

                    @if (!string.IsNullOrEmpty(bl.PhanHoiAdm))
                    {
                        <div class="mt-2 p-2 rounded bg-light">
                            <strong>Admin ph·∫£n h·ªìi:</strong><br />
                            @bl.PhanHoiAdm
                        </div>
                    }
                </td>

                <!-- NG√ÄY -->
                <td>
                    <div>@bl.NgayBL.ToString("dd/MM/yyyy")</div>
                    <div class="text-muted small">@bl.NgayBL.ToString("HH:mm")</div>
                </td>


                <!-- TR·∫†NG TH√ÅI -->
                <td>
                    @if (bl.HienThi)
                    {
                        <span class="badge bg-success">Hi·ªÉn th·ªã</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">·∫®n</span>
                    }
                </td>

                <!-- THAO T√ÅC -->
                <td>
                    <!-- ·∫®N / HI·ªÜN -->
                    <form asp-action="Toggle" method="post" class="d-inline">
                         @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@bl.IdBL" />
                        <button class="btn btn-warning btn-sm mb-1">
                            ·∫®n / Hi·ªán
                        </button>
                    </form>

                    <!-- PH·∫¢N H·ªíI -->
                    <button class="btn btn-primary btn-sm mb-1"
                            data-bs-toggle="collapse"
                            data-bs-target="#reply-@bl.IdBL">
                        Ph·∫£n h·ªìi
                    </button>
                </td>
            </tr>

            <!-- FORM PH·∫¢N H·ªíI ADMIN -->
            <tr class="collapse" id="reply-@bl.IdBL">
                <td colspan="6">
                    <form asp-action="PhanHoi" method="post">
                         @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@bl.IdBL" />

                        <textarea name="phanHoi"
                                  class="form-control mb-2"
                                  rows="3"
                                  placeholder="Nh·∫≠p ph·∫£n h·ªìi c·ªßa admin..."
                                  required></textarea>

                        <button class="btn btn-success btn-sm">
                            G·ª≠i ph·∫£n h·ªìi
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
